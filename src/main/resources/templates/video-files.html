<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Files - VideoHub</title>
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Boldonse&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: "PPSupplyMono";
            src: url("https://assets.codepen.io/7558/PPSupplyMono-Variable.woff2") format("woff2");
            font-weight: 100 900;
            font-style: normal;
        }

        /* Preloader Styles */
        .preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 1;
            transition: opacity 1s ease-out;
        }

        .preloader.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .preloader-content {
            text-align: center;
            color: #e0e0e0;
        }

        .ghost-loader {
            position: relative;
            width: 64px;
            height: 64px;
            margin: 0 auto 30px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .ghost-svg {
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.3));
            animation: ghostFloat 3s ease-in-out infinite;
        }

        .ghost-body {
            fill: white;
            opacity: 0.9;
        }

        .ghost-eye {
            fill: black;
            animation: eyePulse 2s ease-in-out infinite;
            transform-origin: center;
        }

        .left-eye {
            animation-delay: 0s;
        }

        .right-eye {
            animation-delay: 0.1s;
        }

        @keyframes ghostFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        @keyframes eyePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }

        .loading-text {
            font-family: "PPSupplyMono", monospace;
            font-size: 12px;
            text-transform: uppercase;
            opacity: 1;
            margin-bottom: 12px;
            animation: textPulse 2s ease-in-out infinite;
        }

        @keyframes textPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.1; }
        }

        .loading-progress {
            width: 96px;
            height: 1px;
            margin: 0 auto;
            border-radius: 1px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff80, #00cc66);
            opacity: 0.1;
            width: 0%;
            transition: width 0.8s ease;
        }

        .page-content {
            opacity: 0;
            transition: opacity 1.5s ease-in;
        }

        .page-content.fade-in {
            opacity: 1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #2a2a2a 100%);
            min-height: 100vh;
            color: #ffffff;
        }

        /* Header Styles */
        header {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .nav-brand h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(45deg, #ffffff, #8a8a8a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-brand a {
            color: inherit;
            text-decoration: none;
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            background: linear-gradient(135deg, #ffffff 0%, #cccccc 100%);
            color: #000000;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(255, 255, 255, 0.2);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }

        /* Navigation Buttons */
        .home-btn {
            position: fixed;
            top: 100px;
            left: 20px;
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 999;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .home-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(255, 255, 255, 0.1);
        }

        .scroll-buttons {
            position: fixed;
            right: 20px;
            bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 999;
        }

        .scroll-btn {
            width: 50px;
            height: 50px;
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scroll-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(255, 255, 255, 0.1);
        }

        .back-to-top {
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
        }

        .back-to-top.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* Main Upload Content */
        .upload-main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .upload-container {
            background: rgba(20, 20, 20, 0.9);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            overflow: hidden;
        }

        .upload-header {
            text-align: center;
            padding: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .upload-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, #ffffff, #8a8a8a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .upload-header p {
            color: #8a8a8a;
            font-size: 1.1rem;
        }

        .upload-content {
            padding: 2rem;
        }

        /* Steps Progress */
        .upload-steps {
            display: flex;
            justify-content: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .upload-steps::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 20%;
            right: 20%;
            height: 2px;
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-50%);
            z-index: 1;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }

        .step.active {
            background: rgba(255, 255, 255, 0.1);
            border-color: #ffffff;
            box-shadow: 0 8px 24px rgba(255, 255, 255, 0.2);
        }

        .step.completed {
            background: rgba(40, 167, 69, 0.1);
            border-color: #28a745;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #ffffff;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: linear-gradient(135deg, #ffffff, #cccccc);
            color: #000000;
        }

        .step.completed .step-number {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: #ffffff;
        }

        .step.completed .step-number::after {
            content: "‚úì";
            font-weight: bold;
        }

        .step-info h3 {
            color: #ffffff;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .step-info p {
            color: #8a8a8a;
            font-size: 0.9rem;
        }

        /* Form Styles */
        .upload-form {
            position: relative;
        }

        .form-step {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-section {
            margin-bottom: 2rem;
        }

        .form-section h3 {
            color: #ffffff;
            font-size: 1.5rem;
            margin-bottom: 2rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        /* File Upload Styles */
        .upload-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .file-upload-section {
            position: relative;
        }

        .file-upload-label {
            display: block;
            padding: 3rem 2rem;
            border: 3px dashed rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.05);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .file-upload-label:hover {
            border-color: #ffffff;
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(255, 255, 255, 0.1);
        }

        .file-upload-label.drag-over {
            border-color: #28a745;
            background: rgba(40, 167, 69, 0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.8;
        }

        .file-upload-label h4 {
            color: #ffffff;
            margin-bottom: 1rem;
            font-size: 1.4rem;
        }

        .file-upload-label p {
            color: #cccccc;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .file-upload-label small {
            color: #8a8a8a;
            font-size: 0.9rem;
        }

        .file-info {
            display: none;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            margin-top: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .file-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .file-name {
            color: #ffffff;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .file-size {
            color: #8a8a8a;
            font-size: 0.9rem;
        }

        .file-type {
            color: #cccccc;
            font-size: 0.8rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            display: inline-block;
        }

        .remove-file {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid #dc3545;
            color: #dc3545;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.4rem;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-file:hover {
            background: #dc3545;
            color: #ffffff;
            transform: scale(1.1);
        }

        .thumbnail-preview {
            margin-top: 1rem;
            text-align: center;
        }

        .thumbnail-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 12px;
            object-fit: cover;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        /* Upload Progress */
        .upload-progress {
            background: rgba(255, 255, 255, 0.05);
            padding: 2rem;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 2rem;
            display: none;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .progress-header h4 {
            color: #ffffff;
            font-size: 1.2rem;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #8a8a8a;
        }

        /* Form Actions */
        .form-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2rem 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .form-actions .btn {
            padding: 12px 24px;
            font-size: 1rem;
        }

        /* File Requirements */
        .file-requirements {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 2rem;
        }

        .file-requirements h4 {
            color: #ffffff;
            margin-bottom: 1rem;
        }

        .requirements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .requirement-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: #cccccc;
        }

        .requirement-icon {
            color: #28a745;
            font-size: 1.1rem;
        }

        /* Alert Styles */
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            padding: 15px 20px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            max-width: 350px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .alert-success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .alert-error {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }

        .alert-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .upload-main {
                padding: 1rem;
            }

            .upload-content {
                padding: 1rem;
            }

            .upload-header {
                padding: 1rem;
            }

            .upload-header h1 {
                font-size: 2rem;
            }

            .upload-area {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .file-upload-label {
                padding: 2rem 1rem;
                min-height: 250px;
            }

            .upload-icon {
                font-size: 3rem;
            }

            .upload-steps {
                flex-direction: column;
                gap: 1rem;
                align-items: center;
            }

            .upload-steps::before {
                display: none;
            }

            .step {
                padding: 0.75rem 1rem;
                flex-direction: column;
                text-align: center;
            }

            .form-actions {
                flex-direction: column-reverse;
                gap: 1rem;
            }

            .form-actions .btn {
                width: 100%;
            }

            .requirements-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .upload-header h1 {
                font-size: 1.5rem;
            }

            .form-section h3 {
                font-size: 1.2rem;
            }

            .file-upload-label {
                padding: 1.5rem 1rem;
                min-height: 200px;
            }

            .upload-icon {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
<!-- Preloader -->
<div id="preloader" class="preloader">
    <div class="preloader-content">
        <div class="ghost-loader">
            <svg class="ghost-svg" height="80" viewBox="0 0 512 512" width="80" xmlns="http://www.w3.org/2000/svg">
                <path class="ghost-body" d="m508.374 432.802s-46.6-39.038-79.495-275.781c-8.833-87.68-82.856-156.139-172.879-156.139-90.015 0-164.046 68.458-172.879 156.138-32.895 236.743-79.495 275.782-79.495 275.782-15.107 25.181 20.733 28.178 38.699 27.94 35.254-.478 35.254 40.294 70.516 40.294 35.254 0 35.254-35.261 70.508-35.261s37.396 45.343 72.65 45.343 37.389-45.343 72.651-45.343c35.254 0 35.254 35.261 70.508 35.261s35.27-40.772 70.524-40.294c17.959.238 53.798-2.76 38.692-27.94z" fill="white" />
                <circle class="ghost-eye left-eye" cx="208" cy="225" r="22" fill="black" />
                <circle class="ghost-eye right-eye" cx="297" cy="225" r="22" fill="black" />
            </svg>
        </div>
        <div class="loading-text">Loading video files</div>
        <div class="loading-progress">
            <div class="progress-bar"></div>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="page-content" id="main-content">
<header>
    <nav class="navbar">
        <div class="nav-brand">
            <h1><a href="/" style="color: inherit; text-decoration: none;">üé¨ VideoHub</a></h1>
        </div>
        <div class="nav-user">
            <button class="btn btn-secondary" onclick="window.location.href='/'">üè† Home</button>
            <button class="btn btn-secondary" onclick="window.location.href='/profile.html'">üë§ Profile</button>
            <button class="btn" onclick="logout()">üö™ Logout</button>
        </div>
    </nav>
</header>

<!-- Navigation Buttons -->
<a href="/" class="home-btn">üè† Home</a>

<div class="scroll-buttons">
    <button class="scroll-btn back-to-top" id="backToTop" onclick="scrollToTop()" title="Back to Top">
        ‚¨ÜÔ∏è
    </button>
    <button class="scroll-btn" onclick="scrollToBottom()" title="Go to Bottom">
        ‚¨áÔ∏è
    </button>
</div>

<main class="upload-main">
    <div class="upload-container">
        <div class="upload-header">
            <h1>üìÅ Upload Your Files</h1>
            <p>Step 2: Upload your video file and optional thumbnail</p>
        </div>

        <div class="upload-content">
            <div class="upload-steps">
                <div class="step completed" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-info">
                        <h3>Video Details</h3>
                        <p>Basic information about your video</p>
                    </div>
                </div>
                <div class="step active" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-info">
                        <h3>Upload Files</h3>
                        <p>Video file and thumbnail</p>
                    </div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-info">
                        <h3>Settings</h3>
                        <p>Privacy and additional settings</p>
                    </div>
                </div>
            </div>

            <div class="file-requirements">
                <h4>üìã File Requirements</h4>
                <div class="requirements-grid">
                    <div class="requirement-item">
                        <span class="requirement-icon">‚úÖ</span>
                        <span>Video: MP4, MOV, AVI formats</span>
                    </div>
                    <div class="requirement-item">
                        <span class="requirement-icon">‚úÖ</span>
                        <span>Maximum video size: 100MB</span>
                    </div>
                    <div class="requirement-item">
                        <span class="requirement-icon">‚úÖ</span>
                        <span>Thumbnail: JPG, PNG formats</span>
                    </div>
                    <div class="requirement-item">
                        <span class="requirement-icon">‚úÖ</span>
                        <span>Maximum thumbnail size: 5MB</span>
                    </div>
                    <div class="requirement-item">
                        <span class="requirement-icon">‚úÖ</span>
                        <span>Recommended thumbnail: 1280x720px</span>
                    </div>
                    <div class="requirement-item">
                        <span class="requirement-icon">‚úÖ</span>
                        <span>Auto-generated thumbnail if not provided</span>
                    </div>
                </div>
            </div>

            <form id="uploadForm" class="upload-form" onsubmit="handleFileUpload(event)">
                <div class="form-step">
                    <div class="form-section">
                        <h3>üìÅ Upload Files</h3>

                        <div class="upload-area">
                            <div class="file-upload-section">
                                <label for="videoFile" class="file-upload-label" id="videoUploadLabel">
                                    <div class="upload-icon">üé•</div>
                                    <h4>Video File *</h4>
                                    <p>Drag and drop your video here or click to browse</p>
                                    <small>Supported: MP4, MOV, AVI (Max: 100MB)</small>
                                </label>
                                <input type="file" id="videoFile" name="videoFile" accept="video/*" required style="display: none;">
                                <div class="file-info" id="videoFileInfo" style="display: none;">
                                    <div class="file-details">
                                        <div class="file-name"></div>
                                        <div class="file-size"></div>
                                        <div class="file-type"></div>
                                    </div>
                                    <button type="button" class="remove-file" onclick="removeFile('videoFile')">√ó</button>
                                </div>
                            </div>

                            <div class="file-upload-section">
                                <label for="thumbnailFile" class="file-upload-label" id="thumbnailUploadLabel">
                                    <div class="upload-icon">üñºÔ∏è</div>
                                    <h4>Custom Thumbnail</h4>
                                    <p>Upload a custom thumbnail image</p>
                                    <small>Recommended: 1280x720px, JPG/PNG (Max: 5MB)</small>
                                </label>
                                <input type="file" id="thumbnailFile" name="thumbnailFile" accept="image/*" style="display: none;">
                                <div class="file-info" id="thumbnailFileInfo" style="display: none;">
                                    <div class="file-details">
                                        <div class="file-name"></div>
                                        <div class="file-size"></div>
                                        <div class="file-type"></div>
                                    </div>
                                    <button type="button" class="remove-file" onclick="removeFile('thumbnailFile')">√ó</button>
                                </div>
                                <div class="thumbnail-preview" id="thumbnailPreview"></div>
                            </div>
                        </div>

                        <div class="upload-progress" id="uploadProgress">
                            <div class="progress-header">
                                <h4>üì§ Uploading Files...</h4>
                                <span id="uploadPercentage">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <div class="progress-details">
                                <span id="uploadSpeed">0 MB/s</span>
                                <span id="timeRemaining">Calculating...</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="window.location.href='/video-upload.html'">‚Üê Previous</button>
                        <button type="button" class="btn" onclick="window.location.href='/video-settings.html'" id="nextStepBtn">Next Step ‚Üí</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</main>

<script>
    let currentStep = 2; // This is the files upload page (step 2)
    let uploadedFiles = {
        video: null,
        thumbnail: null
    };

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
        loadFormProgress();
        setupFileUploads();
        setupScrollButtons();
        checkAuthStatus();
        updateNextButtonState();
    });

    // Check authentication status
    async function checkAuthStatus() {
        try {
            const response = await fetch('/api/users/current');
            if (!response.ok) {
                showAlert('Please log in to upload videos', 'error');
                setTimeout(() => {
                    window.location.href = '/login';
                }, 2000);
            }
        } catch (error) {
            console.error('Error checking auth status:', error);
            showAlert('Please log in to upload videos', 'error');
            setTimeout(() => {
                window.location.href = '/login';
            }, 2000);
        }
    }

    // Setup scroll buttons functionality
    function setupScrollButtons() {
        const backToTopBtn = document.getElementById('backToTop');

        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                backToTopBtn.classList.add('show');
            } else {
                backToTopBtn.classList.remove('show');
            }
        });
    }

    function scrollToTop() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    }

    function scrollToBottom() {
        window.scrollTo({
            top: document.body.scrollHeight,
            behavior: 'smooth'
        });
    }

    // Setup file upload functionality
    function setupFileUploads() {
        const videoFile = document.getElementById('videoFile');
        const thumbnailFile = document.getElementById('thumbnailFile');
        const videoLabel = document.getElementById('videoUploadLabel');
        const thumbnailLabel = document.getElementById('thumbnailUploadLabel');

        // File input change events
        videoFile.addEventListener('change', function() {
            handleFileSelection(this, 'video');
        });

        thumbnailFile.addEventListener('change', function() {
            handleFileSelection(this, 'thumbnail');
        });

        // Drag and drop events
        setupDragAndDrop(videoLabel, videoFile, 'video');
        setupDragAndDrop(thumbnailLabel, thumbnailFile, 'thumbnail');
    }

    // Setup drag and drop functionality
    function setupDragAndDrop(label, input, type) {
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            label.addEventListener(eventName, preventDefaults, false);
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            label.addEventListener(eventName, () => label.classList.add('drag-over'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            label.addEventListener(eventName, () => label.classList.remove('drag-over'), false);
        });

        label.addEventListener('drop', function(e) {
            const dt = e.dataTransfer;
            const files = dt.files;

            if (files.length > 0) {
                input.files = files;
                handleFileSelection(input, type);
            }
        }, false);
    }

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    // Handle file selection
    function handleFileSelection(input, type) {
        const file = input.files[0];
        if (!file) return;

        const maxSize = type === 'video' ? 100 * 1024 * 1024 : 5 * 1024 * 1024; // 100MB for video, 5MB for thumbnail
        const allowedTypes = type === 'video'
            ? ['video/mp4', 'video/mov', 'video/avi']
            : ['image/jpeg', 'image/png'];

        // Validate file size
        if (file.size > maxSize) {
            showAlert(`File size exceeds the maximum limit of ${type === 'video' ? '100MB' : '5MB'}`, 'error');
            input.value = '';
            return;
        }

        // Validate file type
        if (!allowedTypes.includes(file.type)) {
            showAlert(`Invalid file type. ${type === 'video' ? 'Video' : 'Thumbnail'} file must be ${type === 'video' ? 'MP4, MOV, or AVI' : 'JPG or PNG'}`, 'error');
            input.value = '';
            return;
        }

        // Update file info display
        updateFileInfo(input, type);

        // If both files are uploaded, show the progress bar
        if (uploadedFiles.video && uploadedFiles.thumbnail) {
            document.getElementById('uploadProgress').style.display = 'block';
            startUpload();
        }
    }

    // Update file info display
    function updateFileInfo(input, type) {
        const file = input.files[0];
        const fileName = file.name;
        const fileSize = (file.size / (1024 * 1024)).toFixed(2) + ' MB';
        const fileType = file.type.split('/').pop().toUpperCase();

        document.getElementById(`${type}FileInfo`).style.display = 'flex';
        document.querySelector(`#${type}FileInfo .file-name`).textContent = fileName;
        document.querySelector(`#${type}FileInfo .file-size`).textContent = fileSize;
        document.querySelector(`#${type}FileInfo .file-type`).textContent = fileType;

        uploadedFiles[type] = file;
    }

    // Remove file
    function removeFile(type) {
        document.getElementById(`${type}File`).value = '';
        document.getElementById(`${type}FileInfo`).style.display = 'none';
        uploadedFiles[type] = null;

        // Hide progress bar if both files are removed
        if (!uploadedFiles.video && !uploadedFiles.thumbnail) {
            document.getElementById('uploadProgress').style.display = 'none';
        }
    }

    // Start file upload
    function startUpload() {
        const videoFile = uploadedFiles.video;
        const thumbnailFile = uploadedFiles.thumbnail;

        // Simulate upload progress
        let progress = 0;
        const progressInterval = setInterval(() => {
            progress += Math.random() * 10;
            if (progress >= 100) {
                progress = 100;
                clearInterval(progressInterval);
                // Simulate upload completion
                setTimeout(() => {
                    showAlert('Files uploaded successfully!', 'success');
                    document.getElementById('uploadProgress').style.display = 'none';
                    // Here you can also redirect to another page or perform other actions
                }, 500);
            }

            document.getElementById('uploadPercentage').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';

            // Simulate upload speed and time remaining
            const speed = (Math.random() * 2 + 1).toFixed(2);
            const remaining = ((100 - progress) / speed).toFixed(0);
            document.getElementById('uploadSpeed').textContent = speed + ' MB/s';
            document.getElementById('timeRemaining').textContent = remaining + ' seconds';
        }, 300);
    }

    // Show alert message
    function showAlert(message, type = 'info') {
        const alertBox = document.createElement('div');
        alertBox.className = `alert alert-${type}`;
        alertBox.textContent = message;

        document.body.appendChild(alertBox);

        setTimeout(() => {
            alertBox.remove();
        }, 3000);
    }

    // Load form progress from session storage
    function loadFormProgress() {
        const progress = sessionStorage.getItem('videoUploadProgress');
        if (progress) {
            const { step, video, thumbnail } = JSON.parse(progress);
            currentStep = step;

            // Restore uploaded files
            if (video) {
                uploadedFiles.video = video;
                document.getElementById('videoFileInfo').style.display = 'flex';
                document.querySelector('#videoFileInfo .file-name').textContent = video.name;
                document.querySelector('#videoFileInfo .file-size').textContent = (video.size / (1024 * 1024)).toFixed(2) + ' MB';
                document.querySelector('#videoFileInfo .file-type').textContent = video.type.split('/').pop().toUpperCase();
            }

            if (thumbnail) {
                uploadedFiles.thumbnail = thumbnail;
                document.getElementById('thumbnailFileInfo').style.display = 'flex';
                document.querySelector('#thumbnailFileInfo .file-name').textContent = thumbnail.name;
                document.querySelector('#thumbnailFileInfo .file-size').textContent = (thumbnail.size / (1024 * 1024)).toFixed(2) + ' MB';
                document.querySelector('#thumbnailFileInfo .file-type').textContent = thumbnail.type.split('/').pop().toUpperCase();
            }

            // Update progress bar if both files are uploaded
            if (uploadedFiles.video && uploadedFiles.thumbnail) {
                document.getElementById('uploadProgress').style.display = 'block';
            }
        }
    }

    // Save form progress to session storage
    function saveFormProgress() {
        sessionStorage.setItem('videoUploadProgress', JSON.stringify({ step: currentStep, video: uploadedFiles.video, thumbnail: uploadedFiles.thumbnail }));
    }

    // Navigate to the next step
    function nextStep() {
        // Validate file uploads
        if (!uploadedFiles.video) {
            showAlert('Please upload your video file', 'error');
            return;
        }

        // Save progress and navigate to the next step
        saveFormProgress();
        window.location.href = '/video-settings.html';
    }

    // Navigate to the previous step
    function prevStep() {
        window.location.href = '/video-upload.html';
    }

    // Logout function
    function logout() {
        // Perform logout logic here (e.g., API call, clearing session storage, etc.)
        // For demonstration, we will just redirect to the login page
        window.location.href = '/login';
    }

    // Preloader management
    window.addEventListener('load', function() {
        const preloader = document.getElementById('preloader');
        const mainContent = document.getElementById('main-content');
        const progressBar = document.querySelector('.progress-bar');
        
        // Simulate loading progress
        let progress = 0;
        const interval = setInterval(() => {
            progress += 20;
            progressBar.style.width = progress + '%';
            
            if (progress >= 100) {
                clearInterval(interval);
                
                // Wait a moment then fade out preloader
                setTimeout(() => {
                    preloader.classList.add('fade-out');
                    mainContent.classList.add('fade-in');
                    
                    // Remove preloader from DOM after animation
                    setTimeout(() => {
                        preloader.style.display = 'none';
                    }, 1000);
                }, 500);
            }
        }, 200);
    });
</script>
</div> <!-- Close page-content -->
</body>
</html>
